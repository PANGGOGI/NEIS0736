#!/bin/bash
IFS=$'\n';
workdir=/tmp/
outputdir=/opt/ransomware
outputfile=ransomware.cef
#message_type: CEF, LEEF, KEY
message_type=CEF
## Please set IP address and port where to send data##
cat /dev/null > $outputdir/$outputfile
syslog_server=127.0.0.1
syslog_port=5555
syslog_proto=udp
rm $outputdir/$outputfile
#########################################################
/usr/bin/wget -O ${workdir}ransomware.txt https://ransomwaretracker.abuse.ch/feeds/csv/
#for line in `cat ${workdir}ransomware.txt | grep -v 'Firstseen (UTC),Threat,Malware,Host,URL,Status,Registrar,IP address(es),ASN(s),Country'`; do
for line in `cat ${workdir}ransomware.txt | grep -v 'firstseen,threat,malware,host,url,status,registrar,ip_address,asn,country'`; do
firstseen=`echo $line |sed 's/\"//g' |awk -F "," '{ print $1 }'`
threat=`echo $line |sed 's/\"//g' |awk -F "," '{ print $2 }'`
malware=`echo $line |sed 's/\"//g' | awk -F "," '{ print $3 }'`
host=`echo $line |sed 's/\"//g' | awk -F "," '{ print $4 }'`
url=`echo $line |sed 's/\"//g' |awk -F "," '{ print $5 }' | sed 's/https:\/\///g' | sed 's/http:\/\///g'`
status=`echo $line |sed 's/\"//g' | awk -F "," '{ print $6 }'`
registrar=`echo $line |sed 's/\"//g' | awk -F "," '{ print $7 }'`
ip_address=`echo $line |sed 's/\"//g' | awk -F "," '{ print $8 }'`
asn=`echo $line |sed 's/\"//g' | awk -F "," '{ print $9 }'`
country=`echo $line |sed 's/\"//g' | awk -F "," '{ print $10 }'`
event_time_cef=`date -ud now +"%s"000`
event_time_leef=`date +"%Y-%m-%d %H:%M:%S"`
        case $message_type in
        CEF)
#       echo "CEF:0|Cybertron|Ransomware|1.0|sprwb:101|Ransomware Update Entry|3| start=$event_time_cef end=$event_time_cef dst=$ip_address dhost=$host request=$url cs1=$threat cs2=$malware c$
        echo "CEF:0|Cybertron|Ransomware|1.0|sprwb:101|Ransomware Update Entry|3| start=$event_time_cef end=$event_time_cef dst=$ip_address dhost=$host request=$url cs1=$threat cs2=$malware c$
        ;;
        LEEF)
        echo -e "LEEF:1.0|Cybertron|Ransomware|1.0|sprwb:101|dst=$ip_address\tdhost=$host\trequest=$url\tcs1=$threat\tcs2=$malware\tcs3=$registrar\tcs4=$country\tcs5=$status\tdevTime=$event_t$
        ;;
        KEY)
        ;;
        esac
done
rm -f ${workdir}ransomware.txt
#########################################################


